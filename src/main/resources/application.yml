server:
  port: ${PORT:9101}
  servlet:
    context-path: /

spring:
  application:
    name: anypoint-mq-prometheus-exporter
  main:
    lazy-initialization: false
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration
      - org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  health:
    mail:
      enabled: false
      show-components: always
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true

anypoint:
  baseUrl: https://anypoint.mulesoft.com
  auth:
    # Option 1: Username/password authentication
    username: ${ANYPOINT_USERNAME:}
    password: ${ANYPOINT_PASSWORD:}
    # Option 2: Connected App authentication (preferred)
    clientId: ${ANYPOINT_CLIENT_ID:}
    clientSecret: ${ANYPOINT_CLIENT_SECRET:}
  organizationId: ${ANYPOINT_ORG_ID:}
  autoDiscovery: ${ANYPOINT_AUTO_DISCOVERY:true}
  environments:
    - id: ${ANYPOINT_ENV_ID:}
      name: ${ANYPOINT_ENV_NAME:Development}
  regions:
    - us-east-1
  scrape:
    intervalSeconds: ${SCRAPE_INTERVAL_SECONDS:60}
    periodSeconds: 600
    enabled: true
  http:
    connectTimeoutSeconds: 30
    readTimeoutSeconds: 60
    maxRetries: 3

  # Licensing (for advanced features)
  license:
    key: ${ANYPOINT_LICENSE_KEY:}

  # Advanced Monitors (PRO license required)
  monitors:
    enabled: ${ANYPOINT_MONITORS_ENABLED:true}
    evaluationIntervalSeconds: 60
    defaults:
      cooldownMinutes: 15
      evaluationWindowMinutes: 5
    definitions:
      - name: high-queue-depth
        type: QUEUE_DEPTH
        target: "*"
        condition: GT
        threshold: 1000
        severity: WARNING
        notifications: [slack-ops]
      - name: dlq-alert
        type: DLQ_ALERT
        target: "*"
        threshold: 0
        condition: GT
        severity: CRITICAL
        notifications: [slack-ops, pagerduty]
      - name: throughput-drop
        type: THROUGHPUT_DROP
        target: "*"
        condition: PCT_CHANGE
        threshold: -50
        evaluationWindowMinutes: 30
        severity: WARNING
        notifications: [slack-ops]
      - name: queue-health
        type: QUEUE_HEALTH
        target: "*"
        condition: LT
        threshold: 50
        severity: WARNING
        notifications: [slack-ops]
    notifications:
      channels:
        - name: slack-ops
          type: slack
          enabled: ${SLACK_ENABLED:false}
          webhookUrl: ${SLACK_WEBHOOK_URL:}
        - name: pagerduty
          type: pagerduty
          enabled: ${PAGERDUTY_ENABLED:false}
          routingKey: ${PAGERDUTY_ROUTING_KEY:}
        - name: email-ops
          type: email
          enabled: ${EMAIL_ENABLED:false}
          to: ${ALERT_EMAIL_TO:}
          from: ${ALERT_EMAIL_FROM:noreply@netflexity.com}
        - name: teams-ops
          type: teams
          enabled: ${TEAMS_ENABLED:false}
          webhookUrl: ${TEAMS_WEBHOOK_URL:}
        - name: custom-webhook
          type: webhook
          enabled: ${WEBHOOK_ENABLED:false}
          url: ${WEBHOOK_URL:}
          headers:
            Authorization: "Bearer ${WEBHOOK_TOKEN:}"

# Mail configuration (for email notifications)
spring.mail:
  host: ${MAIL_HOST:localhost}
  port: ${MAIL_PORT:587}
  username: ${MAIL_USERNAME:}
  password: ${MAIL_PASSWORD:}
  properties:
    mail:
      smtp:
        auth: true
        starttls:
          enable: true

logging:
  level:
    com.netflexity.amq.exporter: DEBUG
    org.springframework.web.reactive: INFO
    org.springframework.security: INFO
    io.micrometer: INFO
  pattern:
    console: '%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n'