{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "annotations": { "list": [] },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "Overview",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [
            { "color": "green", "value": null },
            { "color": "yellow", "value": 100 },
            { "color": "red", "value": 1000 }
          ]},
          "mappings": []
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 },
      "id": 1,
      "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "textMode": "auto", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Total Queues",
      "type": "stat",
      "targets": [{ "expr": "count(anypoint_mq_queue)", "legendFormat": "Queues" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [
            { "color": "green", "value": null },
            { "color": "yellow", "value": 10 },
            { "color": "red", "value": 50 }
          ]},
          "mappings": []
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 1 },
      "id": 2,
      "options": { "colorMode": "background", "graphMode": "area", "justifyMode": "auto", "textMode": "auto", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Total Messages In Queue",
      "type": "stat",
      "targets": [{ "expr": "sum(anypoint_mq_queue_messages_in_queue)", "legendFormat": "In Queue" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [
            { "color": "blue", "value": null },
            { "color": "yellow", "value": 10 },
            { "color": "red", "value": 50 }
          ]},
          "mappings": []
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 1 },
      "id": 3,
      "options": { "colorMode": "background", "graphMode": "area", "justifyMode": "auto", "textMode": "auto", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Total Messages In Flight",
      "type": "stat",
      "targets": [{ "expr": "sum(anypoint_mq_queue_messages_in_flight)", "legendFormat": "In Flight" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [
            { "color": "green", "value": null }
          ]},
          "mappings": []
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 1 },
      "id": 4,
      "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "textMode": "auto", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Total Exchanges",
      "type": "stat",
      "targets": [{ "expr": "count(anypoint_mq_exchange_messages_published)", "legendFormat": "Exchanges" }]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 101,
      "title": "Queue Depth",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 15, "spanNulls": true, "axisCenteredZero": false, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 10,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "max"] }, "tooltip": { "mode": "multi" } },
      "title": "Messages In Queue by Environment",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_queue_messages_in_queue{environment=~\"$environment\", queue_name=~\"$queue\"}", "legendFormat": "{{environment}} / {{queue_name}}" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 15, "spanNulls": true, "axisCenteredZero": false, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "id": 11,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "max"] }, "tooltip": { "mode": "multi" } },
      "title": "Messages In Flight by Environment",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_queue_messages_in_flight{environment=~\"$environment\", queue_name=~\"$queue\"}", "legendFormat": "{{environment}} / {{queue_name}}" }]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
      "id": 102,
      "title": "Throughput",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 10, "spanNulls": true, "showPoints": "never", "drawStyle": "bars", "barAlignment": 0 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 15 },
      "id": 20,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Messages Sent (per scrape)",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_queue_messages_sent{environment=~\"$environment\", queue_name=~\"$queue\"}", "legendFormat": "{{environment}} / {{queue_name}}" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 10, "spanNulls": true, "showPoints": "never", "drawStyle": "bars", "barAlignment": 0 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 15 },
      "id": 21,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Messages Received (per scrape)",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_queue_messages_received{environment=~\"$environment\", queue_name=~\"$queue\"}", "legendFormat": "{{environment}} / {{queue_name}}" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 10, "spanNulls": true, "showPoints": "never" },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 23 },
      "id": 22,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Messages Acknowledged (per scrape)",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_queue_messages_acked{environment=~\"$environment\", queue_name=~\"$queue\"}", "legendFormat": "{{environment}} / {{queue_name}}" }]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 31 },
      "id": 103,
      "title": "Exchanges",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 10, "spanNulls": true, "showPoints": "never" },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "id": 30,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Exchange Messages Published",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_exchange_messages_published{environment=~\"$environment\"}", "legendFormat": "{{environment}} / {{exchange_name}}" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "lineWidth": 2, "fillOpacity": 10, "spanNulls": true, "showPoints": "never" },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "id": 31,
      "options": { "legend": { "displayMode": "table", "placement": "bottom", "calcs": ["lastNotNull", "sum"] }, "tooltip": { "mode": "multi" } },
      "title": "Exchange Messages Delivered",
      "type": "timeseries",
      "targets": [{ "expr": "anypoint_mq_exchange_messages_delivered{environment=~\"$environment\"}", "legendFormat": "{{environment}} / {{exchange_name}}" }]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 40 },
      "id": 104,
      "title": "Queue Inventory",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] },
          "custom": { "filterable": true }
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "is_fifo" }, "properties": [{ "id": "custom.width", "value": 80 }] },
          { "matcher": { "id": "byName", "options": "is_dlq" }, "properties": [{ "id": "custom.width", "value": 80 }] },
          { "matcher": { "id": "byName", "options": "max_deliveries" }, "properties": [{ "id": "custom.width", "value": 120 }] }
        ]
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 41 },
      "id": 40,
      "options": { "showHeader": true, "sortBy": [{ "displayName": "queue_name", "desc": false }] },
      "title": "Queue Inventory",
      "type": "table",
      "targets": [{ "expr": "anypoint_mq_queue{environment=~\"$environment\"}", "format": "table", "instant": true }],
      "transformations": [
        { "id": "organize", "options": { "excludeByName": { "Time": true, "Value": true, "__name__": true, "job": true, "instance": true, "ttl": false }, "renameByName": { "queue_name": "Queue", "environment": "Environment", "region": "Region", "is_fifo": "FIFO", "is_dlq": "DLQ", "max_deliveries": "Max Deliveries", "ttl": "TTL (ms)" } } }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 51 },
      "id": 105,
      "title": "Exporter Health",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] },
          "unit": "dateTimeFromNow"
        }
      },
      "gridPos": { "h": 4, "w": 8, "x": 0, "y": 52 },
      "id": 50,
      "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "textMode": "auto", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Last Scrape",
      "type": "stat",
      "targets": [{ "expr": "anypoint_mq_last_scrape_timestamp_seconds * 1000", "legendFormat": "Last Scrape" }]
    }
  ],
  "refresh": "1m",
  "schemaVersion": 39,
  "tags": ["anypoint", "mulesoft", "mq", "prometheus"],
  "templating": {
    "list": [
      {
        "allValue": ".*",
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
        "definition": "label_values(anypoint_mq_queue, environment)",
        "includeAll": true,
        "multi": true,
        "name": "environment",
        "query": { "query": "label_values(anypoint_mq_queue, environment)" },
        "refresh": 2,
        "type": "query"
      },
      {
        "allValue": ".*",
        "current": { "selected": true, "text": "All", "value": "$__all" },
        "datasource": { "type": "prometheus", "uid": "nfx-prometheus" },
        "definition": "label_values(anypoint_mq_queue_messages_in_queue{environment=~\"$environment\"}, queue_name)",
        "includeAll": true,
        "multi": true,
        "name": "queue",
        "query": { "query": "label_values(anypoint_mq_queue_messages_in_queue{environment=~\"$environment\"}, queue_name)" },
        "refresh": 2,
        "type": "query"
      }
    ]
  },
  "time": { "from": "now-6h", "to": "now" },
  "title": "Anypoint MQ Monitoring",
  "uid": "anypoint-mq-monitoring",
  "version": 1
}
